# Journal: 2026-02-11 Night — Full Fleet Monitoring Onboarded

## Summary

Night session focused on onboarding all 5 mesh hosts into a unified monitoring stack: Datadog, Prometheus (node_exporter), and Vector (log shipping to Loki). Also synced wandb dashboard with training metrics through Epoch 26.

## What Got Done

### Monitoring Onboarding

Brought pi2, ThinkStation, and XPS up to parity with pi0/pi1:

| Host | Datadog | Node Exporter | Vector | Prometheus |
|------|---------|---------------|--------|------------|
| pi0 | ✅ Docker | ✅ :9100 | ✅ systemd | ✅ scraped |
| pi1 | ✅ Docker | ✅ :9100 | ✅ systemd | ✅ local |
| pi2 | ✅ Docker | ✅ :9100 | ✅ systemd | ✅ scraped |
| ThinkStation | ✅ Native | ✅ :9100 | ✅ systemd | ✅ scraped |
| XPS | ✅ Native | ✅ :9100 | ✅ systemd | ✅ scraped |

**Pi2 (new):**
- Datadog agent v7 (Docker, hostname `pi2`, tags: `ml-inference`)
- Node exporter via apt
- Vector binary install → systemd service → Loki sink
- Prometheus: node-pi2, icmp-pi2, http-sentinelnet targets
- pi0 Datadog TCP checks: pi2_ssh, pi2_sentinelnet, pi2_node_exporter

**ThinkStation (upgraded):**
- Already had Datadog native agent
- Node exporter enabled (was installed but inactive)
- Vector binary at `/root/.vector/bin/vector` → systemd service → Loki sink
- Windows port proxy for 9100 (WSL doesn't expose ports to LAN by default)
- Prometheus: node-thinkstation, icmp-thinkstation targets

**XPS (new):**
- Datadog native agent installed (hostname `xps`)
- Node exporter via apt, bind changed to `0.0.0.0:9100`
- Vector binary install → systemd service → Loki sink
- Windows port proxy: 9100 → WSL IP (172.18.57.194)
- Firewall rules for 9100 on Windows
- Prometheus: node-xps, icmp-xps targets

### Prometheus Config Updates (pi1)
Added scrape targets for pi2, ThinkStation, XPS:
- `node-pi2` (192.168.2.202:9100)
- `node-thinkstation` (192.168.2.80:9100)
- `node-xps` (192.168.2.71:9100)
- `http-sentinelnet` (HTTP probe on :8000/health)
- ICMP probes for all three

### Datadog TCP Checks (pi0)
Added to pi0's check config:
- pi2: SSH, SentinelNet :8000, node_exporter :9100
- ThinkStation: node_exporter :9100
- XPS: SSH, node_exporter :9100

### wandb Sync
- Synced offline run `rp9sfghv` from XPS → ThinkStation → wandb.ai
- Dashboard shows training through Epoch 26: 98.74% accuracy, loss 0.031
- https://wandb.ai/jag927-nasa/sentinelnet/runs/rp9sfghv

### XPS Stability
- DNS broke again after Windows reboot (resolvectl doesn't persist)
- Fixed with persistent config: `/etc/systemd/resolved.conf.d/dns.conf`
- DNS servers: 192.168.2.101 (AdGuard primary), 192.168.2.70 (secondary), 1.1.1.1 (fallback)
- McAfee and NordVPN confirmed as root cause of network instability — removed
- Training process killed by reboot; best checkpoint saved at `checkpoints/best.pt` (~Epoch 26)

### SentinelNet README
- Rewrote with scientific overview, architecture, infrastructure table
- Added training status, wandb link, pipeline diagram
- Made accessible to non-ML readers without dumbing it down

### Repo Commits
- `9e7e3c0` — evening journal (training + wandb)
- `730e6a5` — consistency fixes (num_workers, torch import, deps)
- `5e212cb` — README with training status
- `81818eb` — plain english overview
- `1a2a9b1` — scientific rewrite of intro

## Lessons Learned

### WSL Port Proxy for Monitoring
WSL2 services bind inside the VM and aren't accessible from LAN. For each port you want exposed:
```powershell
netsh interface portproxy add v4tov4 listenport=PORT listenaddress=0.0.0.0 connectport=PORT connectaddress=WSL_IP
New-NetFirewallRule -DisplayName "NAME" -Direction Inbound -LocalPort PORT -Protocol TCP -Action Allow
```
Gotcha: `connectaddress=localhost` works for SSH but not always for other services. Use the actual WSL IP (`wsl hostname -I`) for reliability. WSL IP changes on reboot, so port proxies may need updating.

### Persistent DNS in WSL2
`resolvectl` settings don't survive reboots. Use drop-in config:
```bash
sudo mkdir -p /etc/systemd/resolved.conf.d
sudo tee /etc/systemd/resolved.conf.d/dns.conf << 'EOF'
[Resolve]
DNS=192.168.2.101 192.168.2.70 1.1.1.1
Domains=~.
EOF
sudo systemctl restart systemd-resolved
```

## Next Steps
1. Restart SentinelNet training on XPS (process died in reboot)
2. Finish remaining ~24 epochs
3. Final wandb sync
4. Export best model to ONNX, deploy to pi2
5. Build Grafana dashboard panels for new hosts
6. Rotate exposed wandb + HuggingFace tokens
